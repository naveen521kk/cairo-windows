version: '{build}'
max_jobs: 1
build: off
test: off
deploy: off
image: Visual Studio 2017

init:
 - cmd: |
     choco install msys2 --params="/InstallDir:%CD:~0,2%\msys64 /NoPath"
     set PATH=%CD:~0,2%\msys64\usr\bin;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem
     %CD:~0,2%\msys64\usr\bin\pacman --noconfirm -Syyuu
     %CD:~0,2%\msys64\usr\bin\pacman --noconfirm -Syuu
          
build_script:
 - ps: |
     $env:CHERE_INVOKING = 'yes'  # Preserve the current working directory
     $env:MSYSTEM = 'MINGW64'  # Start a 64 bit Mingw environment
     bash -lc "pacman -S --noconfirm tar make"
     $env:PATH="$PWD\msys64\usr\bin;$env:PATH"
     bash -lc "./build-cairo-windows.sh"
